        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>JUNIOR GROUPS - COSMOS LEARNER PRO</title>
            <style>
                :root { 
                    --blue: #00d2ff; --yellow: #fde047; --green: #22c55e; 
                    --red: #ef4444; --purple: #a855f7; --ans-highlight: #2563eb; 
                    --bg: #020617; --formula-bg: #fff7ed; --formula-text: #9a3412;
                }
                body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: white; }
                #space-bg { position: fixed; inset: 0; z-index: 0; background: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }

                /* HUD ƒêI·ªÇM S·ªê & RANK */
                #game-hud {
                    position: fixed; top: 20px; left: 20px; z-index: 10001;
                    background: rgba(0,0,0,0.6); padding: 15px 25px; border-radius: 20px;
                    border: 2px solid var(--blue); display: none;
                }
                .hud-item { font-weight: bold; font-size: 20px; margin-bottom: 5px; }
                .hud-val { color: var(--yellow); text-shadow: 0 0 10px var(--yellow); }

                /* 1. WELCOME OVERLAY */
                #welcome-overlay { position: fixed; inset: 0; z-index: 10000; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 1s; cursor: pointer; }
                .glitch-text { font-size: 70px; font-weight: 900; color: white; text-shadow: 2px 2px var(--blue), -2px -2px var(--red); animation: pulse 2s infinite; }
                
                /* 2. ENTRY SCREEN */
                #entry-screen { position: fixed; inset: 0; z-index: 9500; background: radial-gradient(circle, #1e293b, #020617); display: none; flex-direction: column; justify-content: center; align-items: center; }
                .input-box { background: rgba(255,255,255,0.1); border: 3px solid var(--blue); padding: 40px; border-radius: 40px; text-align: center; backdrop-filter: blur(10px); }
                .name-input { background: none; border: none; border-bottom: 4px solid var(--yellow); color: white; font-size: 35px; text-align: center; width: 300px; outline: none; margin: 30px 0; }

                /* MENU CH√çNH */
                #menu-screen { position: fixed; inset: 0; z-index: 9000; display: none; flex-direction: column; justify-content: center; align-items: center; background: rgba(2, 6, 23, 0.98); }
                .welcome-text { font-size: 24px; color: var(--yellow); letter-spacing: 8px; font-weight: bold; text-transform: uppercase; }
                .intro-title { font-size: 60px; color: var(--blue); margin: 10px 0; font-weight: 900; text-shadow: 0 0 30px rgba(0, 210, 255, 0.5); }
                
                #info-btn { padding: 10px 30px; background: none; border: 2px solid var(--yellow); color: var(--yellow); border-radius: 50px; cursor: pointer; margin-bottom: 20px; font-weight: bold; transition: 0.3s; }
                #info-btn:hover { background: var(--yellow); color: black; }

                .game-selection { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 10px; }
                .game-card { width: 350px; padding: 20px; border: 4px solid var(--blue); border-radius: 35px; cursor: pointer; transition: 0.3s; text-align: center; background: rgba(0, 210, 255, 0.05); }
                .game-card:hover { transform: translateY(-10px); background: rgba(0, 210, 255, 0.2); border-color: white; }

                /* PROJECT OVERVIEW MODAL */
                #project-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; justify-content: center; align-items: center; }
                .modal-content { background: #0f172a; border: 4px solid var(--blue); padding: 40px; border-radius: 40px; width: 85%; max-width: 900px; text-align: left; }
                .modal-header { font-size: 35px; color: var(--yellow); font-weight: 900; margin-bottom: 20px; text-align: center; border-bottom: 1px solid #334155; padding-bottom: 10px; }
                .info-item { margin-bottom: 20px; }
                .info-label { color: var(--blue); font-weight: bold; font-size: 22px; display: block; }
                .info-text { font-size: 18px; line-height: 1.5; color: #cbd5e1; }

                /* RULE OVERLAY */
                #rule-overlay { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.95); z-index: 9500; display: none; justify-content: center; align-items: center; }
                .rule-box { background: #1e293b; border: 6px solid var(--blue); padding: 50px; border-radius: 50px; text-align: center; width: 80%; max-width: 800px; }
                .rule-title { color: var(--yellow); font-size: 45px; margin-bottom: 25px; font-weight: 900; text-transform: uppercase; }
                .rule-desc-en { font-size: 26px; font-weight: bold; color: white; margin-bottom: 15px; }
                .rule-desc-vi { font-size: 20px; color: var(--blue); font-style: italic; margin-bottom: 40px; }

                /* UI CHUNG */
                #exit-btn { position: fixed; top: 20px; right: 20px; padding: 10px 25px; background: var(--red); color: white; border: none; border-radius: 10px; cursor: pointer; z-index: 10000; display: none; font-weight: bold; }
                .screen { position: absolute; inset: 0; display: none; z-index: 100; }
                #car { position: absolute; left: 100px; width: 140px; height: 70px; z-index: 1000; }
                .car-body { width: 100%; height: 100%; background: var(--yellow); border-radius: 12px 50px 12px 12px; border: 5px solid #000; }
                .rock { position: absolute; width: 240px; height: 90px; background: rgba(255,255,255,0.1); border: 4px solid var(--blue); border-radius: 60px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 28px; }
                #robot { position: absolute; bottom: 250px; left: 80px; width: 85px; height: 120px; transition: left 0.6s, bottom 0.4s; }
                .robot-head { width: 60px; height: 55px; background: var(--yellow); border-radius: 15px; margin: 0 auto; border: 5px solid #1e293b; }
                .robot-body { width: 80px; height: 60px; background: var(--yellow); border-radius: 12px; margin: 5px auto; border: 5px solid #1e293b; }
                .pad { position: absolute; bottom: 180px; width: 220px; height: 35px; background: rgba(30, 41, 59, 0.95); border: 3px solid var(--purple); border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 20px; }
                #question-area-g3, #mission-hub { position: absolute; top: 6%; left: 50%; transform: translateX(-50%); width: 85%; max-width: 1100px; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 40px; border: 3px solid var(--blue); text-align: center; font-size: 32px; font-weight: bold; }
                #meteor { position: absolute; right: -600px; top: 45%; transform: translateY(-50%); width: 400px; height: 180px; background: linear-gradient(135deg, #4b5563, #1f2937); border: 8px solid #94a3b8; border-radius: 60px; display: flex; align-items: center; justify-content: center; font-size: 60px; font-weight: 900; color: var(--yellow); }
                #quiz-box { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -60%); background: white; color: black; padding: 40px; border-radius: 40px; width: 85%; max-width: 700px; z-index: 8000; display: none; }
                #explanation-overlay, #congrats-screen { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98); display: none; justify-content: center; align-items: center; z-index: 9000; }
                .result-box { background: white; color: #0f172a; padding: 40px; border-radius: 50px; width: 90%; max-width: 1000px; text-align: center; border-bottom: 15px solid var(--green); }
                .highlight-ans { color: var(--ans-highlight); font-weight: 900; text-decoration: underline; }
                .meaning-highlight { color: var(--ans-highlight); font-weight: bold; font-size: 24px; }
                .formula-box { background: var(--formula-bg); color: var(--formula-text); padding: 20px; border-radius: 20px; border: 2px solid #fdba74; margin: 20px 0; text-align: left; font-family: monospace; font-size: 22px; }
                .btn-style { padding: 20px 40px; border-radius: 15px; font-size: 24px; font-weight: bold; cursor: pointer; border: none; }
                .btn-ans { display: block; width: 100%; text-align: left; margin: 8px 0; background: #f1f5f9; border: 3px solid #e2e8f0; }
                @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

                /* B·ªî SUNG ƒê·ªí H·ªåA GAME 4 */
                #g4-visuals { margin-top: 20px; position: relative; height: 150px; }
                #ship-frame { font-size: 80px; transition: transform 0.5s; filter: drop-shadow(0 0 15px var(--blue)); }
                .energy-core { position: absolute; width: 20px; height: 20px; background: var(--yellow); border-radius: 50%; box-shadow: 0 0 15px var(--yellow); bottom: 0; left: 50%; opacity: 0; }
                @keyframes fly-up { 0% { bottom: 0; opacity: 1; } 100% { bottom: 100px; opacity: 0; transform: scale(1.5); } }
                #energy-meter { width: 300px; height: 15px; border: 2px solid var(--blue); border-radius: 10px; margin: 15px auto; overflow: hidden; }
                #energy-fill { width: 0%; height: 100%; background: var(--blue); transition: 1s; box-shadow: 0 0 10px var(--blue); }
            </style>
        </head>
        <body>

            <audio id="sfx-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
            <audio id="sfx-wrong" src="https://assets.mixkit.co/active_storage/sfx/2648/2648-preview.mp3"></audio>
            <audio id="sfx-jump" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>
            <audio id="bg-g1" src="https://assets.mixkit.co/active_storage/sfx/2513/2513-preview.mp3" loop></audio>
            <audio id="bg-g2" src="https://assets.mixkit.co/active_storage/sfx/1103/1103-preview.mp3" loop></audio>
            <audio id="bg-g3" src="https://assets.mixkit.co/active_storage/sfx/2522/2522-preview.mp3" loop></audio>
            <audio id="bg-g4" src="https://assets.mixkit.co/active_storage/sfx/1987/1987-preview.mp3" loop></audio>

            <div id="game-hud">
                <div class="hud-item">SCORE: <span id="hud-score" class="hud-val">0</span></div>
                <div class="hud-item">RANK: <span id="hud-rank" class="hud-val">RECRUIT</span></div>
            </div>

            <div id="welcome-overlay" onclick="goToEntry()">
                <div class="glitch-text">COSMOS LEARNER PRO</div>
                <p style="margin-top:20px; letter-spacing:3px; color:white;">CLICK ANYWHERE TO START</p>
            </div>

            <div id="entry-screen">
                <div class="input-box">
                    <h2 style="color:var(--blue); font-size:30px;">IDENTIFY YOURSELF</h2>
                    <p>Enter your name, Space Ranger!</p>
                    <input type="text" id="user-name" class="name-input" placeholder="Your Name..." onkeydown="if(event.key==='Enter') saveName()">
                    <br>
                    <button class="btn-style" style="background:var(--yellow); color:black;" onclick="saveName()">CONFIRM IDENTITY</button>
                </div>
            </div>

            <div id="space-bg"></div>
            <button id="exit-btn" onclick="backToMenu()">EXIT GAME ‚úñ</button>

            <div id="menu-screen">
                <div class="welcome-text">WELCOME, <span id="display-name" style="color:white;">RANGER</span>!</div>
                <h1 class="intro-title">COSMOS LEARNER</h1>
                <button id="info-btn" onclick="toggleModal(true)">üìã PROJECT OVERVIEW (INFO)</button>
                <div class="game-selection">
                    <div class="game-card" onclick="showRules(1)"><h2>üèéÔ∏è RACER</h2><p>VOCAB: AI & MASS MEDIA</p></div>
                    <div class="game-card" onclick="showRules(2)"><h2>ü§ñ JUMP</h2><p>TOPIC: PREPOSITIONS</p></div>
                    <div class="game-card" onclick="showRules(3)"><h2>‚òÑÔ∏è WORD MINER</h2><p>WORD FORMATION</p></div>
                    <div class="game-card" onclick="showRules(4)"><h2>üõ†Ô∏è CONSTRUCTOR</h2><p>GRAMMAR MASTERY</p></div>
                </div>
            </div>

            <div id="project-modal">
                <div class="modal-content">
                    <div class="modal-header">PROJECT PRESENTATION</div>
                    <div class="info-item">
                        <span class="info-label">Group Name:</span>
                        <span class="info-text">Junior Groups</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Game Name:</span>
                        <span class="info-text">Cosmos Learner Pro</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Learning Objectives (M·ª•c ƒë√≠ch):</span>
                        <span class="info-text">- Master AI-related vocabulary and English Grammar.<br>- Enhancing student engagement through interactive missions.<br>- Provide immediate feedback with detailed grammar formulas.</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">User Manual (H∆∞·ªõng d·∫´n):</span>
                        <span class="info-text">1. Choose a mission from the hub.<br>2. Read the briefing rules.<br>3. Interact with game objects to trigger questions.<br>4. Select the correct answer to complete the mission.</span>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn-style" style="background: var(--blue); color: white;" onclick="toggleModal(false)">CLOSE (QUAY L·∫†I)</button>
                    </div>
                </div>
            </div>

            <div id="rule-overlay">
                <div class="rule-box">
                    <h2 id="rule-title" class="rule-title">MISSION BRIEFING</h2>
                    <p id="rule-desc-en" class="rule-desc-en"></p>
                    <p id="rule-desc-vi" class="rule-desc-vi"></p>
                    <button class="btn-style" style="background: var(--green); color: white;" onclick="startAfterRules()">I'M READY! (B·∫ÆT ƒê·∫¶U)</button>
                </div>
            </div>

            <div id="game-container">
                <div id="sc-1" class="screen" onmousemove="moveCar(event)"><div id="car"><div class="car-body"></div></div><div id="rock-container"></div></div>
                <div id="sc-2" class="screen"><div id="world" style="position:absolute; width:10000px; height:100%; transition: 0.6s;"><div id="robot"><div class="robot-head"></div><div class="robot-body"></div></div><div id="pads"></div></div></div>
                <div id="sc-3" class="screen"><div id="question-area-g3"></div><div id="meteor">ROOT</div><div id="g3-cannons" style="position:fixed; bottom:40px; left:50%; transform:translateX(-50%); display:flex; gap:15px; width:80%;"></div></div>
                <div id="sc-4" class="screen">
                    <div id="mission-hub">
                        <div id="g4-visuals">
                            <div id="ship-frame">üöÄ</div>
                            <div id="energy-meter"><div id="energy-fill"></div></div>
                        </div>
                        <div id="g4-q"></div>
                    </div>
                    <div id="energy-blocks" style="position:fixed; bottom:8%; left:50%; transform:translateX(-50%); display:flex; gap:15px; width:80%;"></div>
                </div>
            </div>

            <div id="quiz-box"><div id="q-text" style="font-size:28px; font-weight:800; margin-bottom:20px; color:#0f172a;"></div><div id="ans-list"></div></div>
            <div id="explanation-overlay"><div class="result-box"><div id="exp-sentence" style="font-size:32px; font-weight:800; margin-bottom:15px;"></div><div id="exp-meaning" style="font-size:22px; color:#475569; font-style:italic;"></div><div id="formula-container" class="formula-box"><strong style="color:var(--purple)">üí° Grammar Remember:</strong><div id="exp-formula"></div></div><button class="btn-style" style="background:var(--green); color:white; margin-top:20px;" onclick="closeExp()">NEXT MISSION ‚Üí</button></div></div>
            <div id="congrats-screen"><div style="text-align: center;"><h1 style="font-size:80px; color:var(--yellow);">MISSION COMPLETE!</h1><h2 id="final-rank-text">RANK: COSMOS MASTER</h2><button class="btn-style" style="background: var(--blue); color: white; margin-top: 40px;" onclick="backToMenu()">BACK TO HUB (HOME)</button></div></div>

            <script>
                // --- LOGIC ƒêI·ªÇM S·ªê & RANK ---
                let score = 0;
                let rank = "RECRUIT";
                const ranks = ["RECRUIT", "SOLDIER", "CAPTAIN", "COMMANDER", "COSMOS MASTER"];

                function updateHUD() {
                    document.getElementById("hud-score").innerText = score;
                    let rankIdx = Math.min(Math.floor(score / 400), 4);
                    rank = ranks[rankIdx];
                    document.getElementById("hud-rank").innerText = rank;
                }

                function playSound(id) {
                    const sound = document.getElementById(id);
                    if(sound) {
                        sound.currentTime = 0;
                        sound.play().catch(e => console.log("Sound play blocked"));
                    }
                }

                function stopAllBGSounds() {
                    ["bg-g1", "bg-g2", "bg-g3", "bg-g4"].forEach(id => {
                        const s = document.getElementById(id);
                        s.pause(); s.currentTime = 0;
                    });
                }

                // --- LOGIC M·ªû ƒê·∫¶U ---
                function goToEntry() {
                    document.getElementById("welcome-overlay").style.opacity = "0";
                    setTimeout(() => {
                        document.getElementById("welcome-overlay").style.display = "none";
                        document.getElementById("entry-screen").style.display = "flex";
                    }, 800);
                }

                function saveName() {
                    const name = document.getElementById("user-name").value;
                    if(name.trim() === "") { alert("Please enter your name!"); return; }
                    document.getElementById("display-name").innerText = name.toUpperCase();
                    document.getElementById("entry-screen").style.display = "none";
                    document.getElementById("menu-screen").style.display = "flex";
                }

                function backToMenu() {
                    isMoving = false; 
                    stopAllBGSounds();
                    document.getElementById("exit-btn").style.display = "none";
                    document.getElementById("game-hud").style.display = "none";
                    document.getElementById("quiz-box").style.display = "none";
                    document.getElementById("explanation-overlay").style.display = "none";
                    document.getElementById("congrats-screen").style.display = "none";
                    document.querySelectorAll(".screen").forEach(s => s.style.display = "none");
                    document.getElementById("world").style.transform = "translateX(0px)"; 
                    document.getElementById("robot").style.left = "80px";
                    document.getElementById("menu-screen").style.display = "flex";
                }

                // --- D·ªÆ LI·ªÜU GAME (GI·ªÆ NGUY√äN) ---
                const data1 = [
                    { q: "1. Scientists are using highly ______ technology to explore space.", a: ["TRADITIONAL", "ADVANCED", "DEVELOPING", "BASIC"], c: 1, m: "C√°c nh√† khoa h·ªçc ƒëang s·ª≠ d·ª•ng c√¥ng ngh·ªá <span class='meaning-highlight'>TI√äN TI·∫æN</span> ƒë·ªÉ kh√°m ph√° kh√¥ng gian." },
                    { q: "2. A ______ library provides digital resources.", a: ["VISUAL", "FACE-TO-FACE", "VIRTUAL", "NORMAL"], c: 2, m: "M·ªôt th∆∞ vi·ªán <span class='meaning-highlight'>·∫¢O</span> cung c·∫•p c√°c t√†i nguy√™n k·ªπ thu·∫≠t s·ªë." },
                    { q: "3. ChatGPT is an AI ______.", a: ["ROBOT", "RECOGNITION", "PORTFOLIO", "CHATBOT"], c: 3, m: "ChatGPT l√† m·ªôt <span class='meaning-highlight'>CHATBOT</span> tr√≠ tu·ªá nh√¢n t·∫°o." },
                    { q: "4. Engineers are ______ the data.", a: ["COUNTING", "ARCHIVING", "ANALYSING", "ACTIVATING"], c: 2, m: "C√°c k·ªπ s∆∞ ƒëang <span class='meaning-highlight'>PH√ÇN T√çCH</span> d·ªØ li·ªáu." },
                    { q: "5. We use ______ to unlock the ship.", a: ["FACIAL RECOGNITION", "CHATBOT", "VIRTUAL REALITY", "ROBOT"], c: 0, m: "Ch√∫ng ta s·ª≠ d·ª•ng <span class='meaning-highlight'>NH·∫¨N DI·ªÜN KHU√îN M·∫∂T</span> ƒë·ªÉ m·ªü kh√≥a con t√†u." }
                ];
                const data2 = [
                    { q: "21. Both sexes are equally capable ______ looking after children.", a: ["OF", "OFF", "FOR", "IN"], c: 0, m: "C·∫£ hai gi·ªõi ƒë·ªÅu c√≥ <span class='meaning-highlight'>KH·∫¢ NƒÇNG (OF)</span> chƒÉm s√≥c con c√°i nh∆∞ nhau." },
                    { q: "22. He writes them out ______ hand.", a: ["WITH", "ON", "BY", "AT"], c: 2, m: "Anh ·∫•y ƒë√£ t·ª± tay vi·∫øt ch√∫ng <span class='meaning-highlight'>B·∫∞NG TAY (BY)</span>." },
                    { q: "23. Everyone benefited ______ the share-out of the profits.", a: ["ON", "FROM", "UP", "AT"], c: 1, m: "M·ªçi ng∆∞·ªùi ƒë·ªÅu ƒë∆∞·ª£c <span class='meaning-highlight'>H∆Ø·ªûNG L·ª¢I T·ª™ (FROM)</span> vi·ªác chia l·ª£i nhu·∫≠n." },
                    { q: "24. She bought shoes which are very similar ______ a pair she had.", a: ["WITH", "ABOUT", "TO", "FOR"], c: 2, m: "C√¥ ·∫•y mua ƒë√¥i gi√†y m·ªõi r·∫•t <span class='meaning-highlight'>GI·ªêNG V·ªöI (TO)</span> ƒë√¥i c√¥ ·∫•y ƒë√£ c√≥ tr∆∞·ªõc ƒë√≥." },
                    { q: "25. I have no time to engage ______ gossip.", a: ["AFTER", "UNDER", "ON", "IN"], c: 3, m: "T√¥i kh√¥ng c√≥ th·ªùi gian ƒë·ªÉ <span class='meaning-highlight'>THAM GIA V√ÄO (IN)</span> nh·ªØng chuy·ªán phi·∫øm." }
                ];
                const data3 = [
                    { r: "RELY", q: "It is difficult to find ______ sources of news.", opts: ["RELIANCE", "RELY", "RELIABLE", "RELIABLY"], c: 2, m: "Th·∫≠t kh√≥ ƒë·ªÉ t√¨m th·∫•y c√°c ngu·ªìn tin t·ª©c <span class='meaning-highlight'>ƒê√ÅNG TIN C·∫¨Y</span>." },
                    { r: "RECOGNIZE", q: "Smartphones use facial ______ technology.", opts: ["RECOGNITION", "RECOGNIZABLE", "RECOGNIZABLY", "RECOGNIZED"], c: 0, m: "ƒêi·ªán tho·∫°i s·ª≠ d·ª•ng c√¥ng ngh·ªá <span class='meaning-highlight'>NH·∫¨N DI·ªÜN</span> khu√¥n m·∫∑t." },
                    { r: "ANALYZE", q: "The computer is performing an ______ of data.", opts: ["ANALYZE", "ANALYSIS", "ANALYTICAL", "ANALYTICALLY"], c: 1, m: "M√°y t√≠nh ƒëang th·ª±c hi·ªán m·ªôt b·∫£n <span class='meaning-highlight'>PH√ÇN T√çCH</span> d·ªØ li·ªáu." },
                    { r: "INFORM", q: "The documentary was very ______.", opts: ["INFORMATION", "INFORMED", "INFORMATIVE", "INFORMANT"], c: 2, m: "B·ªô phim t√†i li·ªáu cung c·∫•p r·∫•t <span class='meaning-highlight'>NHI·ªÄU TH√îNG TIN</span>." },
                    { r: "INTERACT", q: "The AI allows for better ______ between humans.", opts: ["INTERACTION", "INTERACTIVE", "INTERACTIVELY", "INTERACTED"], c: 0, m: "AI cho ph√©p s·ª± <span class='meaning-highlight'>T∆Ø∆†NG T√ÅC</span> t·ªët h∆°n gi·ªØa con ng∆∞·ªùi." }
                ];
                const data4 = [
                    { q: "The bigger the city gets, the ______ crowded it becomes.", opts: ["MORE", "MOST", "MANY", "MUCH"], c: 0, m: "Th√†nh ph·ªë c√†ng l·ªõn, n√≥ c√†ng tr·ªü n√™n <span class='meaning-highlight'>ƒê√îNG ƒê√öC H∆†N</span>.", f: "THE + Comp. + S + V, THE + Comp. + S + V" },
                    { q: "It is the first time I ______ such a beautiful AI.", opts: ["SEE", "SAW", "HAVE EVER SEEN", "AM SEEING"], c: 2, m: "L·∫ßn <span class='meaning-highlight'>ƒê·∫¶U TI√äN T√îI TH·∫§Y (HAVE SEEN)</span> AI ƒë·∫πp nh∆∞ v·∫≠y.", f: "It is the first time + S + have/has + V3/ed" },
                    { q: "AI helps humans, ______ it cannot replace emotions.", opts: ["AND", "BUT", "SO", "OR"], c: 1, m: "AI gi√∫p con ng∆∞·ªùi, <span class='meaning-highlight'>NH∆ØNG (BUT)</span> n√≥ kh√¥ng thay th·∫ø ƒë∆∞·ª£c c·∫£m x√∫c.", f: "Compound Sentence: S+V, [but] S+V" },
                    { q: "We start the mission ______ the satellite is ready.", opts: ["WHEN", "THOUGH", "BUT", "SO"], c: 0, m: "Ch√∫ng ta b·∫Øt ƒë·∫ßu <span class='meaning-highlight'>KHI (WHEN)</span> v·ªá tinh s·∫µn s√†ng.", f: "Complex Sentence: S+V + [when] + S+V" },
                    { q: "Because it ______, the launch was cancelled.", opts: ["STORM", "STORMS", "STORMED", "STORMING"], c: 2, m: "V√¨ tr·ªùi <span class='meaning-highlight'>ƒê√É C√ì B√ÉO</span>, v·ª• ph√≥ng b·ªã h·ªßy.", f: "Because + S + V" }
                ];

                let activeGame = 0, currentQ = 0, isMoving = false, mX = -600;

                function toggleModal(show) { document.getElementById("project-modal").style.display = show ? "flex" : "none"; }

                function showRules(id) {
                    activeGame = id; currentQ = 0; score = 0; 
                    updateHUD();
                    const rt = document.getElementById("rule-title");
                    const rdEn = document.getElementById("rule-desc-en");
                    const rdVi = document.getElementById("rule-desc-vi");
                    document.getElementById("rule-overlay").style.display = "flex";
                    
                    if(id === 1) { rt.innerText = "üèéÔ∏è RACER RULES"; rdEn.innerText = "HIT the Data Cores to unlock AI vocab questions!"; rdVi.innerText = "Lu·∫≠t ch∆°i: ƒê√¢m v√†o c√°c kh·ªëi d·ªØ li·ªáu ƒë·ªÉ m·ªü c√¢u h·ªèi t·ª´ v·ª±ng!"; }
                    else if(id === 2) { rt.innerText = "ü§ñ JUMP RULES"; rdEn.innerText = "Jump to Power Stations to solve Preposition challenges."; rdVi.innerText = "Lu·∫≠t ch∆°i: Nh·∫£y ƒë·∫øn c√°c tr·∫°m ƒë·ªÉ gi·∫£i ƒë·ªë gi·ªõi t·ª´."; }
                    else if(id === 3) { rt.innerText = "‚òÑÔ∏è WORD MINER RULES"; rdEn.innerText = "Blast the meteor before it hits your base!"; rdVi.innerText = "Lu·∫≠t ch∆°i: B·∫Øn thi√™n th·∫°ch tr∆∞·ªõc khi n√≥ va v√†o cƒÉn c·ª©!"; }
                    else if(id === 4) { rt.innerText = "üõ†Ô∏è CONSTRUCTOR RULES"; rdEn.innerText = "Build perfect grammar structures to power the ship."; rdVi.innerText = "Lu·∫≠t ch∆°i: X√¢y d·ª±ng c·∫•u tr√∫c ng·ªØ ph√°p ƒë·ªÉ n·∫°p ƒëi·ªán cho t√†u."; }
                }

                function startAfterRules() {
                    document.getElementById("rule-overlay").style.display = "none";
                    document.getElementById("menu-screen").style.display = "none";
                    document.getElementById("exit-btn").style.display = "block";
                    document.getElementById("game-hud").style.display = "block";
                    document.querySelectorAll(".screen").forEach(s => s.style.display = "none");
                    document.getElementById(`sc-${activeGame}`).style.display = "block";
                    
                    stopAllBGSounds();
                    playSound(`bg-g${activeGame}`);

                    if(activeGame === 2) initJumpBridge();
                    if(activeGame === 4) { 
                        document.getElementById("energy-fill").style.width = "0%";
                        document.getElementById("ship-frame").style.transform = "scale(1)";
                    }
                    triggerAction();
                }

                function triggerAction() {
                    if(activeGame === 1) spawnRacerObstacle();
                    else if(activeGame === 2) robotJump();
                    else if(activeGame === 3) startMinerMeteor();
                    else if(activeGame === 4) loadConstructor();
                }

                function spawnRacerObstacle() {
                    const rc = document.getElementById("rock-container");
                    const y = Math.random() * (window.innerHeight - 300) + 150;
                    rc.innerHTML = `<div class="rock" id="active-rock" style="right:0; top:${y}px">DATA CORE</div>`;
                    let rx = 0; isMoving = true;
                    function loop() {
                        if(!isMoving) return; rx += 20; document.getElementById("active-rock").style.right = rx + "px";
                        if(rx > window.innerWidth - 300) { isMoving = false; showQuiz(); }
                        else requestAnimationFrame(loop);
                    }
                    loop();
                }

                function initJumpBridge() {
                    const p = document.getElementById("pads"); p.innerHTML = "";
                    for(let i=0; i<5; i++) {
                        let d = document.createElement("div"); d.className = "pad";
                        d.style.left = (600 + i*800) + "px"; d.id = `p-${i}`; d.innerText = `STATION ${i+1}`;
                        p.appendChild(d);
                    }
                }

                function robotJump() {
                    playSound('sfx-jump');
                    const r = document.getElementById("robot"); const t = document.getElementById(`p-${currentQ}`);
                    r.style.bottom = "500px";
                    setTimeout(() => {
                        const x = t.offsetLeft + 50; r.style.left = x + "px"; r.style.bottom = "215px";
                        document.getElementById("world").style.transform = `translateX(-${x - 200}px)`;
                        setTimeout(showQuiz, 600);
                    }, 300);
                }

                function startMinerMeteor() {
                    const d = data3[currentQ];
                    document.getElementById("question-area-g3").innerHTML = d.q.replace("______", "<span style='color:var(--yellow)'>______</span>");
                    document.getElementById("meteor").innerText = d.r;
                    const c = document.getElementById("g3-cannons"); c.innerHTML = "";
                    d.opts.forEach((o, i) => {
                        const b = document.createElement("button"); b.className = "btn-style btn-ans"; b.innerText = o;
                        b.onclick = () => { 
                            if(i === d.c) {
                                playSound('sfx-correct');
                                score += 100;
                                updateHUD();
                                showExp(d.q.replace("______", `<span class='highlight-ans'>${o}</span>`), d.m); 
                            } else {
                                playSound('sfx-wrong');
                                b.style.background = "var(--red)"; 
                            }
                        };
                        c.appendChild(b);
                    });
                    mX = -600; isMoving = true;
                    function loop() {
                        if(!isMoving) return; mX += 10; document.getElementById("meteor").style.right = mX + "px";
                        if(mX > window.innerWidth/3) isMoving = false; else requestAnimationFrame(loop);
                    }
                    loop();
                }

                function loadConstructor() {
                    const d = data4[currentQ];
                    document.getElementById("g4-q").innerHTML = d.q.replace("______", "<span style='color:var(--yellow)'>______</span>");
                    const eb = document.getElementById("energy-blocks"); eb.innerHTML = "";
                    d.opts.forEach((o, i) => {
                        const b = document.createElement("button"); b.className = "btn-style btn-ans"; b.innerText = o;
                        b.onclick = () => { 
                            if(i === d.c) {
                                playSound('sfx-correct');
                                score += 100;
                                updateHUD();
                                
                                // HI·ªÜU ·ª®NG GAME 4
                                const core = document.createElement("div"); core.className = "energy-core";
                                document.getElementById("g4-visuals").appendChild(core);
                                core.style.animation = "fly-up 0.8s forwards";
                                document.getElementById("energy-fill").style.width = (currentQ + 1) * 20 + "%";
                                document.getElementById("ship-frame").style.transform = `scale(${1 + (currentQ + 1) * 0.1})`;

                                showExp(d.q.replace("______", `<span class='highlight-ans'>${o}</span>`), d.m, d.f); 
                            } else {
                                playSound('sfx-wrong');
                                b.style.background = "var(--red)"; 
                            }
                        };
                        eb.appendChild(b);
                    });
                }

                function showQuiz() {
                    const d = (activeGame === 1) ? data1[currentQ] : data2[currentQ];
                    document.getElementById("q-text").innerText = d.q;
                    const al = document.getElementById("ans-list"); al.innerHTML = "";
                    d.a.forEach((o, i) => {
                        const b = document.createElement("button"); b.className = "btn-style btn-ans"; b.innerText = o;
                        b.onclick = () => { 
                            if(i === d.c) { 
                                playSound('sfx-correct');
                                score += 100;
                                updateHUD();
                                document.getElementById("quiz-box").style.display = "none"; 
                                showExp(d.q.replace("______", `<span class='highlight-ans'>${o}</span>`), d.m); 
                            } else { 
                                playSound('sfx-wrong');
                                b.style.color = "red"; 
                            }
                        };
                        al.appendChild(b);
                    });
                    document.getElementById("quiz-box").style.display = "block";
                }

                function showExp(sen, mean, form = null) {
                    document.getElementById("exp-sentence").innerHTML = sen;
                    document.getElementById("exp-meaning").innerHTML = "Meaning: " + mean;
                    const fc = document.getElementById("formula-container");
                    if(form) { fc.style.display = "block"; document.getElementById("exp-formula").innerText = form; }
                    else fc.style.display = "none";
                    document.getElementById("explanation-overlay").style.display = "flex";
                }

                function closeExp() {
                    document.getElementById("explanation-overlay").style.display = "none";
                    currentQ++;
                    if(currentQ < 5) triggerAction();
                    else {
                        document.getElementById("final-rank-text").innerText = "RANK REACHED: " + rank;
                        document.getElementById("congrats-screen").style.display = "flex";
                    }
                }

                function moveCar(e) { if(activeGame === 1) document.getElementById("car").style.top = Math.max(50, Math.min(e.clientY - 35, window.innerHeight - 100)) + "px"; }
            </script>
        </body>
        </html>
